<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>a1: COMP151 Programming Assignment 2, Spring 2007</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li id="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>COMP151 Programming Assignment 2, Spring 2007</h1>
<p>
<b>Author:</b> <a href="http://www.cs.ust.hk/~dekai/">Dekai Wu</a><p>
<b>Date:</b> Due 2007.03.28 at 23:00 by CASS<p>
<b>Download:</b> <a href="../../../assignments/a2.tar.gz">http://www.cs.ust.hk/~dekai/151/assignments/a2.tar.gz</a><p>
<b>Assignment page:</b> <a href="index.html">http://www.cs.ust.hk/~dekai/151/assignments/a2/html/</a><p>
<b>Course page:</b> <a href="../../../index.html">http://www.cs.ust.hk/~dekai/151/</a><p>
<h3>Your assignment</h3>
<p>
You are assigned to maintain and extend the expression evaluator code built in <a href="../../../assignments/a1/html/index.html">Assignment 1</a>. Your job this time is to take the following steps.<p>
<h3>Step 1: Re-design Cell using polymorphism</h3>
<p>
Completely re-implement the <code>Cell</code> class, to eliminate the use of a tagged union, by instead making use of polymorphism virtual functions. The <code>Cell</code> class is to become an abstract base class (ABC). Derived classes should include <code>IntCell</code>, <code>DoubleCell</code>, <code>SymbolCell</code>, and <code>ConsCell</code>.<p>
After this step, your <code><a class="el" href="eval_8hpp.html#6e55b5c1dddfa3a8b0885d50cdaec560">eval()</a></code> implementation from Assignment 1 should still work (assuming you didn't break encapsulation!) Note that the interface specified in <code><a class="el" href="cons_8hpp.html">cons.hpp</a></code> has <em>not</em> changed. The function <em>definitions</em> in <code><a class="el" href="cons_8hpp.html">cons.hpp</a></code> may have changed to fit the new <code>Cell</code> implementation's use of late binding, but the <em>declarations</em> have not. This means that <code><a class="el" href="parse_8cpp.html#0c86c1253ed6de8893e3843e4e606d65">parse()</a></code> and <code><a class="el" href="eval_8hpp.html#6e55b5c1dddfa3a8b0885d50cdaec560">eval()</a></code> and any other functions that made proper use of the interface encapsulated by <code><a class="el" href="cons_8hpp.html">cons.hpp</a></code> should all still work.<p>
<h3>Step 2: Do a cleaner re-design of <a class="el" href="eval_8hpp.html#6e55b5c1dddfa3a8b0885d50cdaec560">eval()</a> to take advantage of polymorphism</h3>
<p>
Re-design your <code><a class="el" href="eval_8hpp.html#6e55b5c1dddfa3a8b0885d50cdaec560">eval()</a></code> implementation to be much cleaner, taking advantage of the polymorphism to get rid of all those ugly <code>if-then-else</code> and/or <code>switch</code> statements from your Assignment 1 version, by instead making appropriate use of function overriding and/or overloading.<p>
To accomplish this step, you will have to extend the interface in <code><a class="el" href="Cell_8hpp.html">Cell.hpp</a></code>. Because of this, note that after this step, your new <code><a class="el" href="eval_8hpp.html#6e55b5c1dddfa3a8b0885d50cdaec560">eval()</a></code> implementation may no longer work with your old implementation of the <code>Cell</code> class from Assignment 1.<p>
<h3>Step 3: Generalize to add more arithmetic operators</h3>
<p>
Take advantage of the cleaner polymorphic implementation, to add more arithmetic operators <em>neatly</em>. Besides the <code>+</code> and <code>ceiling</code> operators from Assignment 1, you should add the <code>-</code>, <code>*</code>, <code>/</code>, and <code>floor</code> arithmetic operators for <code>int</code> and <code>double</code> operands.<p>
Note that the <code>-</code>, <code>*</code>, and <code>/</code> operators are generalized similarly to the <code>+</code> operator. The <code>-</code>, <code>*</code>, and <code>/</code> operators can also be called with more than two arguments; for example, <code>(- 11 2 3)</code> means the same thing as <code>(- (- 11 2) 3)</code>. The same holds for the <code>*</code> and <code>/</code> operators, so for example, <code>(* 11 2 3)</code> means the same thing as <code>(* (* 11 2) 3)</code>, while <code>(/ 11 2 3)</code> means the same thing as <code>(/ (/ 11 2) 3)</code>.<p>
If the <code>*</code> operator is called with zero arguments, then it simply returns 1, which is the identity value for multiplication (just like 0 for the <code>+</code> operator). If the <code>*</code> operator is called with one argument, then it returns the same value.<p>
If the <code>-</code> operator is called with one argument, then it simply returns the negative of the argument. If the <code>/</code> operator is called with one argument, then it simply returns the inverse of the argument.<p>
To avoid ambiguity, the <code>-</code> and <code>/</code> operators <em>cannot</em> be called with zero arguments, unlike the <code>+</code> and <code>*</code> operators. So, for example <code>(-)</code> is considered to be a semantically ill-formed expression.<p>
If you've done things correctly, you should notice how much easier it is to add all these operators, now that you have polymorphism.<p>
<h3>Step 4: Implement quoted expressions</h3>
<p>
Next you will add support for <em>quoted expressions</em>, which allow you to prevent <code><a class="el" href="eval_8hpp.html#6e55b5c1dddfa3a8b0885d50cdaec560">eval()</a></code> from trying to evaluate s-expressions. The special <code>quote</code> operator takes exactly one operand, which can be <em>any</em> s-expression, and simply returns the exact same expression. The operand is <em>not</em> evaluated, so it just needs to be a syntactically valid tree (including empty lists as well as leaf nodes representing atomic ints, doubles, or symbols). It does <em>not</em> need to be a semantically valid expression. For example:<p>
<code>&gt; (quote (a b c))<br>
 (a b c)<br>
 &gt; (quote (+ 2 3))<br>
 (+ 2 3)<br>
 &gt; (quote (if if 5))<br>
 (if if 5)<br>
 &gt; (quote ())<br>
 ()<br>
 &gt; (quote (quote (a b c)))<br>
 (quote (a b c))<br>
 &gt; (quote hello)<br>
 hello<br>
 &gt; (quote 6)<br>
 6<br>
 &gt; (quote 3.14)<br>
 3.14<br>
 &gt; (+ 4 (quote 2))<br>
 6<br>
 &gt; (+ 4 (quote (* 2 3)))<br>
 ERROR: operand of + cannot be a list<br>
 &gt; (+ 4 (* 2 3))<br>
 10</code><p>
<h3>Step 5: Expose <code>cons</code>, <code>car</code>, <code>cdr</code>, and <code>nullp</code> in Scheme</h3>
<p>
Finally, you will expose your existing <code><a class="el" href="cons_8hpp.html">cons.hpp</a></code> C++ implementation of <code>cons</code>, <code>car</code>, <code>cdr</code>, and <code>nullp</code> so that they can be called from Scheme just like other operators such as <code>ceiling</code>:<p>
<code>&gt; (cons 4 (quote ()))<br>
 (4)<br>
 &gt; (cons (quote hello) (cons 4 (quote ())))<br>
 (hello 4)<br>
 &gt; (cons 2 (cons (quote hello) (cons 4 (quote ()))))<br>
 (2 hello 4)<br>
 &gt; (car (cons 2 (cons (quote hello) (cons 4 (quote ())))))<br>
 2<br>
 &gt; (cdr (cons 2 (cons (quote hello) (cons 4 (quote ())))))<br>
 (hello 4)<br>
 &gt; (nullp foo)<br>
 0<br>
 &gt; (nullp 0)<br>
 0<br>
 &gt; (nullp 1)<br>
 0<br>
 &gt; (nullp (quote ()))<br>
 1<br>
 &gt; (nullp (quote (a b c)))<br>
 0</code><p>
<h3>Putting it all together</h3>
<p>
This time, we are not including any dummy implementation of <code><a class="el" href="Cell_8hpp.html">Cell.hpp</a></code>, <code>Cell.cpp</code> or <code>eval.cpp</code> at all. The implementation is up to you. But be careful! You must make sure your <code>Cell</code> interface fits what <code><a class="el" href="cons_8hpp.html">cons.hpp</a></code> expects!<p>
We're again including <code><a class="el" href="parse_8cpp.html">parse.cpp</a></code> for your convenience, in case you want to build your assignment on some other machine outside the lab. But remember you shouldn't look inside <code><a class="el" href="parse_8cpp.html">parse.cpp</a></code> at all. (In the real world, you would only get the separately-compiled <code>parse.o</code>, so you <em>couldn't</em> look inside <code><a class="el" href="parse_8cpp.html">parse.cpp</a></code> even if you wanted to!)<p>
<h3>Important reminders</h3>
<p>
You must follow the design approach outlined in this document. Do <em>not</em> just implement the required functionality using a different design.<p>
You are expected to make best possible use of polymorphism and virtual functions. For example, of course your old <code><a class="el" href="eval_8hpp.html#6e55b5c1dddfa3a8b0885d50cdaec560">eval()</a></code> from Assignment 1 should still work, but without making correct use of polymorphism throughout, it will not be considered a solution to Assignment 2 (even if it implements the additional operators).<p>
This time you <em>must</em> use virtual functions in this assignment, but you still may <em>not</em> use templates. This assignment is about dynamic OO support in C++. (You'll get a chance to use templates in the following assignment...)<p>
Remember we are focusing on proper use of encapsulation. So you still should <em>not</em> edit the files <code><a class="el" href="parse_8hpp.html">parse.hpp</a></code>, <code><a class="el" href="parse_8cpp.html">parse.cpp</a></code>, <code><a class="el" href="cons_8hpp.html">cons.hpp</a></code>, <code><a class="el" href="eval_8hpp.html">eval.hpp</a></code>, or <code><a class="el" href="main_8cpp.html">main.cpp</a></code>. Again, the programming assignments are mini-exercises in how multiple programmers are supposed to interact and communicate in the real world; these files are <em>owned</em> and <em>maintained</em> by the other author(s).<p>
You will need to turn in a tar file <code>a2.tar.gz</code> containing all source files including your own implementation of <code><a class="el" href="Cell_8hpp.html">Cell.hpp</a></code>, <code>Cell.cpp</code>, and <code>eval.cpp</code>. Depending on your approach, you may or may not also wish to add more files. You should also make sure to include all doxygen generated HTML documentation.<p>
Depending on your approach, you may or may not need to change the <code>Makefile</code>. Whether you changed it or not, always make sure you include whatever <code>Makefile</code> is needed to build your program, when you submit assignment. Otherwise, the graders cannot build your program.<p>
You must write the final version of the program on your own. Sophisticated plagiarism detection systems are in operation, and they are pretty good at catching copying! If you worked in study groups, you must also acknowledge your collaborators in the write-up for each problem, whether or not they are classmates. Other cases will be dealt with as plagiarism. Re-read the policy on the course home page, and note the University's tougher policy this year regarding cheating.<p>
<b>Your programming style (how clearly and how well you speak C++) is what will be graded. Correct functioning of your program is necessary but not sufficient!</b> <hr size="1"><address style="align: right;"><small>Generated on Wed Mar 14 16:30:44 2007 for a1 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
